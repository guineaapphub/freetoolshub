<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Candy Match Generator ‚Äì Pro Plus</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --sidebar-bg: #0f172a;
      --sidebar-bg-soft: #111827;
      --sidebar-text: #f9fafb;
      --accent: #2563eb;
      --accent-soft: #1d4ed8;
      --accent-green: #16a34a;
      --border-soft: #1f2937;
      --page-bg: #ffffff;
      --answer-color: #c81e1e;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: var(--font-main);
      background: #020617;
      color: var(--sidebar-text);
      height: 100vh;
      overflow: hidden;
    }

    .app-shell {
      display: grid;
      grid-template-columns: 360px minmax(0, 1fr);
      height: 100vh;
    }

    /* LEFT PANEL */

    .sidebar {
      background: radial-gradient(circle at top left, #1d3557, #020617);
      border-right: 1px solid #1f2937;
      padding: 16px 18px 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .sidebar-header {
      margin-bottom: 6px;
    }

    .tool-tier {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #a5b4fc;
      margin-bottom: 4px;
    }

    .tool-title {
      font-size: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tool-title span.badge-proplus {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      background: linear-gradient(135deg, #f97316, #ec4899);
      color: #fff;
    }

    .sidebar-scroll {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
      scrollbar-width: thin;
    }

    .panel {
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.88);
      border: 1px solid rgba(148, 163, 184, 0.12);
      padding: 10px 12px 12px;
      margin-bottom: 10px;
    }

    .panel h3 {
      margin: 0 0 6px;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #cbd5f5;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    label {
      font-size: 12px;
      display: block;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    input[type="text"],
    select,
    textarea {
      width: 100%;
      border-radius: 8px;
      border: 1px solid #374151;
      background: #020617;
      color: #f9fafb;
      font-size: 13px;
      padding: 7px 9px;
      outline: none;
    }

    input[type="text"]:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.4);
    }

    textarea {
      resize: vertical;
      min-height: 90px;
      max-height: 180px;
    }

    .small-note {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .row-inline {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .row-inline > * {
      flex: 1;
    }

    .btn {
      border-radius: 999px;
      border: none;
      font-size: 13px;
      font-weight: 500;
      padding: 9px 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: transform 0.05s ease, box-shadow 0.05s ease,
        background 0.15s ease;
      white-space: nowrap;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
      box-shadow: 0 8px 24px rgba(37, 99, 235, 0.48);
    }

    .btn-primary:hover {
      background: var(--accent-soft);
    }

    .btn-ghost {
      background: #111827;
      color: #e5e7eb;
      border: 1px solid #374151;
    }

    .btn-ghost:hover {
      background: #020617;
    }

    .btn-green {
      background: var(--accent-green);
      color: white;
      box-shadow: 0 8px 24px rgba(22, 163, 74, 0.5);
    }

    .btn-green:hover {
      background: #15803d;
    }

    .btn-small {
      padding: 6px 9px;
      font-size: 12px;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #e5e7eb;
      margin-top: 4px;
    }

    .checkbox-row input {
      margin: 0;
    }

    .badge-locked {
      font-size: 11px;
      padding: 1px 7px;
      border-radius: 999px;
      border: 1px solid #f97316;
      color: #fed7aa;
      background: rgba(30, 64, 175, 0.4);
      margin-left: 6px;
    }

    .toggle-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
      margin-top: 4px;
    }

    .toggle-row span {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .toggle {
      width: 40px;
      height: 20px;
      border-radius: 999px;
      background: #111827;
      border: 1px solid #4b5563;
      position: relative;
      cursor: pointer;
    }

    .toggle-thumb {
      position: absolute;
      top: 1px;
      left: 1px;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #6b7280;
      transition: transform 0.15s ease, background 0.15s ease;
    }

    .toggle-active {
      background: #1e293b;
      border-color: #f59e0b;
    }

    .toggle-active .toggle-thumb {
      transform: translateX(18px);
      background: #facc15;
    }

    .color-input-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      margin-top: 6px;
    }

    .color-input-row input[type="color"] {
      width: 28px;
      height: 20px;
      border-radius: 6px;
      border: 1px solid #4b5563;
      padding: 0;
      background: transparent;
    }

    /* RIGHT PREVIEW */

    .preview-shell {
      background: radial-gradient(circle at top, #111827, #020617 55%);
      padding: 18px 18px 18px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow: hidden;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #e5e7eb;
      font-size: 13px;
    }

    .preview-header-title {
      font-weight: 500;
      opacity: 0.8;
    }

    .preview-actions {
      display: flex;
      gap: 8px;
    }

    .preview-area {
      flex: 1;
      overflow-y: auto;
      background: radial-gradient(circle at top, #1f2937, #020617 60%);
      border-radius: 16px;
      padding: 18px;
      box-shadow: inset 0 0 0 1px rgba(148, 163, 184, 0.16);
    }

    .page-stack {
      max-width: 960px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
      align-items: center;
    }

    .page {
      background: var(--page-bg);
      width: 800px;
      height: 1035px; /* 8.5 x 11-ish at screen scale */
      padding: 60px 72px 40px;
      box-shadow: 0 18px 60px rgba(15, 23, 42, 0.9);
      border-radius: 14px;
      color: #111827;
      position: relative;
    }

    .page h1 {
      margin: 0;
      font-size: 30px;
      letter-spacing: 0.12em;
      text-align: center;
    }

    .page .subtitle {
      margin-top: 8px;
      font-size: 15px;
      font-weight: 600;
      text-align: center;
    }

    .editable {
      cursor: text;
    }

    .page-main {
      margin-top: 42px;
      display: grid;
      grid-template-columns: 1.4fr 1fr;
      gap: 32px;
      font-size: 14px;
    }

    .clue-list,
    .candy-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .clue-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .blank {
      display: inline-block;
      min-width: 70px;
      border-bottom: 2px solid #111827;
      height: 0;
      position: relative;
    }

    .blank.answer {
      border-bottom-color: #9ca3af;
    }

    .answer-letter {
      position: absolute;
      left: 50%;
      top: -18px;
      transform: translateX(-50%);
      font-weight: 700;
      color: var(--answer-color);
      font-size: 16px;
    }

    .number {
      min-width: 24px;
      text-align: right;
      font-weight: 500;
      margin-right: 4px;
    }

    .clue-text {
      flex: 1;
      font-weight: 500;
    }

    .candy-row {
      display: flex;
      gap: 6px;
      align-items: baseline;
    }

    .candy-letter {
      font-weight: 600;
      min-width: 18px;
    }

    .candy-text {
      flex: 1;
    }

    .page-footer {
      position: absolute;
      bottom: 26px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 11px;
      color: #6b7280;
    }

    .page-label {
      position: absolute;
      bottom: 10px;
      right: 24px;
      font-size: 11px;
      color: #9ca3af;
    }

    /* Answer key page tweaks */

    .page.answer-key-page h2 {
      margin: 0;
      font-size: 18px;
      text-align: center;
      letter-spacing: 0.16em;
    }

    .answer-key-wrap {
      margin-top: 32px;
      display: grid;
      grid-template-columns: 1.4fr 1fr;
      gap: 32px;
      font-size: 14px;
    }

    .answer-key-page .blank {
      border-bottom: 2px solid #9ca3af;
    }

    /* Grid overlay (Pro Plus feature) */

    .page.grid-overlay::before {
      content: "";
      position: absolute;
      inset: 40px 40px 40px 40px;
      pointer-events: none;
      background-image: linear-gradient(
          to right,
          rgba(148, 163, 184, 0.25) 1px,
          transparent 1px
        ),
        linear-gradient(
          to bottom,
          rgba(148, 163, 184, 0.25) 1px,
          transparent 1px
        );
      background-size: 24px 24px;
      mix-blend-mode: multiply;
      opacity: 0.7;
    }

    @media (max-width: 1100px) {
      .app-shell {
        grid-template-columns: minmax(0, 1fr);
      }
      .sidebar {
        height: 50vh;
      }
      .preview-shell {
        height: 50vh;
      }
      .page {
        transform: scale(0.8);
        transform-origin: top center;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- LEFT: CONTROL PANEL -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="tool-tier">Pro Plus ‚Ä¢ Candy Match Generator</div>
        <div class="tool-title">
          üç¨ Candy Match
          <span class="badge-proplus">üëë Pro Plus</span>
        </div>
      </div>

      <div class="sidebar-scroll">
        <section class="panel">
          <h3>Theme & Style</h3>
          <label for="themeInput">Theme / Topic</label>
          <input
            id="themeInput"
            type="text"
            placeholder="e.g. Bible Verses, Halloween, Christmas"
          />

          <label for="styleSelect" style="margin-top: 8px;">Style / Audience</label>
          <select id="styleSelect">
            <option value="kids">Kids (Themed)</option>
            <option value="family">Family / Church</option>
            <option value="party">Party / Youth Group</option>
          </select>

          <label for="candyLocale" style="margin-top: 8px;">Candy Locale (Pro Plus)</label>
          <select id="candyLocale">
            <option value="us">USA Candy Names</option>
            <option value="uk">UK Candy Names</option>
          </select>

          <div class="toggle-row" style="margin-top: 10px;">
            <span>
              ‚≠ê Bonus Bible Cross-Match
              <span class="badge-locked">Pro Plus</span>
            </span>
            <div id="crossMatchToggle" class="toggle toggle-active">
              <div class="toggle-thumb"></div>
            </div>
          </div>
          <div class="small-note">
            Mix Bible verses with any niche (Christmas, Halloween, Harvest, etc.).
          </div>
        </section>

        <section class="panel">
          <h3>Manual Word List</h3>
          <label for="wordList">Enter / paste / upload words</label>
          <textarea
            id="wordList"
            placeholder="One clue word per line. Pro Plus can auto-fill up to 20 lines into the game layout."
          ></textarea>
          <div class="small-note">
            Tip: Type a theme above and paste related terms here (e.g. PUMPKIN, CANDY,
            GHOST...). Uploading a .txt file will append to this list.
          </div>

          <div class="row-inline" style="margin-top: 10px;">
            <button id="uploadTxtBtn" class="btn btn-ghost btn-small">
              ‚¨ÜÔ∏è Upload .txt
            </button>
            <button id="cleanSortBtn" class="btn btn-ghost btn-small">
              üßπ Clean & Sort
            </button>
          </div>

          <input
            type="file"
            id="hiddenFileInput"
            accept=".txt"
            style="display:none"
          />

          <div class="small-note">
            Pro Plus: up to 100 words stored; up to 20 auto-filled into a puzzle.
          </div>
        </section>

        <section class="panel">
          <h3>Game Layout</h3>
          <label for="titleInput">Game Title</label>
          <input id="titleInput" type="text" value="CANDY MATCH" />

          <label for="subtitleInput" style="margin-top: 6px;">Subtitle</label>
          <input
            id="subtitleInput"
            type="text"
            value="Match the clue to the candy it describes!"
          />

          <div class="checkbox-row" style="margin-top: 8px;">
            <input type="checkbox" id="gridOverlayCheckbox" />
            <label for="gridOverlayCheckbox" style="margin-bottom: 0;"
              >Grid overlay (design alignment)</label
            >
          </div>

          <div class="color-input-row">
            <span>Answer key color</span>
            <input type="color" id="answerColorPicker" value="#c81e1e" />
          </div>
        </section>

        <section class="panel">
          <h3>Generate & Export</h3>
          <div class="row-inline">
            <button id="generateBtn" class="btn btn-primary">
              üéØ Generate Game
            </button>
            <button id="printBtn" class="btn btn-green">
              ‚¨áÔ∏è Print / PDF
            </button>
          </div>
          <div class="small-note" style="margin-top: 6px;">
            ‚ÄúPrint / PDF‚Äù opens your browser‚Äôs print dialog. Choose ‚ÄúSave as PDF‚Äù to
            download both pages.
          </div>
        </section>
      </div>
    </aside>

    <!-- RIGHT: PREVIEW -->
    <main class="preview-shell">
      <div class="preview-header">
        <div class="preview-header-title">Preview ‚Ä¢ Game & Answer Key</div>
        <div class="preview-actions">
          <button id="quickRegenerateBtn" class="btn btn-ghost btn-small">
            üîÅ Shuffle Only
          </button>
        </div>
      </div>

      <div class="preview-area" id="previewArea">
        <div class="page-stack">
          <section class="page" id="gamePage">
            <div contenteditable="true" class="editable" id="titleDisplayWrapper">
              <h1 id="gameTitle">CANDY MATCH</h1>
            </div>
            <div
              contenteditable="true"
              class="subtitle editable"
              id="subtitleDisplay"
            >
              Match the clue to the candy it describes!
            </div>

            <div class="page-main">
              <div class="clue-list" id="clueList"></div>
              <div class="candy-list" id="candyList"></div>
            </div>

            <div class="page-footer">
              Pro Plus Edition ‚Äì fully editable layout
            </div>
            <div class="page-label">Page 1 ‚Äì Game</div>
          </section>

          <section class="page answer-key-page" id="answerPage">
            <h1 id="answerTitle">CANDY MATCH</h1>
            <h2 id="answerKeyHeading">ANSWER KEY</h2>

            <div class="answer-key-wrap">
              <div class="clue-list" id="answerClueList"></div>
              <div class="candy-list" id="answerCandyList"></div>
            </div>

            <div class="page-footer">
              Answer key generated automatically from the current game layout.
            </div>
            <div class="page-label">Page 2 ‚Äì Answer Key</div>
          </section>
        </div>
      </div>
    </main>
  </div>

  <script>
    // ---------- BASIC DATA ----------

    const usCandy = [
      "Skittles",
      "Butterfinger",
      "PayDay",
      "Life Savers",
      "Reese\u2019s Pieces",
      "Milky Way",
      "Snickers",
      "Kit Kat",
      "100 Grand",
      "Twix",
      "Baby Ruth",
      "Hershey\u2019s Kiss",
      "M&M\u2019s",
      "Starburst",
      "Tootsie Pop",
      "Sour Patch Kids",
      "Hot Tamales",
      "Jolly Rancher",
      "Almond Joy",
      "Nerds"
    ];

    const ukCandy = [
      "Mars Bar",
      "Galaxy",
      "Smarties",
      "Maltesers",
      "Double Decker",
      "Crunchie",
      "Topic",
      "Lion Bar",
      "Aero",
      "Twirl",
      "Flake",
      "Boost",
      "Wispa",
      "Dairy Milk",
      "Fruit Pastilles",
      "Wine Gums",
      "Jelly Babies",
      "Toffee Crisp",
      "Curly Wurly",
      "Flying Saucers"
    ];

    // Sample Bible cross-match sets so the feature is immediately playable.
    const bibleCrossSets = {
      halloween: {
        terms: [
          "PUMPKIN",
          "CANDY",
          "GHOST",
          "LANTERN",
          "BAT",
          "FEAR",
          "SPIDER",
          "AUTUMN",
          "MASK",
          "SEASON",
          "BREEZE",
          "SNAKE"
        ],
        verses: [
          "LEVITICUS 11:18",
          "2 TIMOTHY 1:7",
          "PSALM 119:103",
          "JEREMIAH 5:24",
          "DANIEL 2:21",
          "JOHN 3:8",
          "GENESIS 1:29",
          "LUKE 12:2",
          "MATTHEW 5:15",
          "NUMBERS 21:9",
          "LUKE 24:39",
          "JOB 8:14"
        ]
      },
      harvest: {
        terms: [
          "TURKEY",
          "FEAST",
          "LEAVES",
          "FAMILY",
          "HARVEST",
          "PROVISION",
          "FRIENDS",
          "AUTUMN",
          "BLESSINGS",
          "SEASON",
          "BREEZE",
          "FIELD"
        ],
        verses: [
          "LUKE 10:2",
          "PHILIPPIANS 4:19",
          "REVELATION 19:9",
          "JEREMIAH 5:24",
          "PSALM 65:9",
          "JOHN 3:8",
          "MATTHEW 6:26",
          "JAMES 1:17",
          "GENESIS 2:24",
          "LEVITICUS 19:19",
          "PSALM 1:3",
          "PROVERBS 18:24"
        ]
      }
    };

    const FREE_LINES = 10; // concept only; here Pro Plus uses up to 20
    const PROPLUS_LINES = 20;

    // ---------- HELPERS ----------

    function $(id) {
      return document.getElementById(id);
    }

    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function cleanWordList(text) {
      return text
        .split(/\r?\n/)
        .map((l) => l.trim())
        .filter((l) => l.length > 0);
    }

    function getCandyList() {
      const locale = $("candyLocale").value || "us";
      return locale === "uk" ? ukCandy.slice() : usCandy.slice();
    }

    function getCrossSetFromTheme(theme, style) {
      const t = (theme || "").toLowerCase();
      if (t.includes("harvest") || t.includes("thanksgiving")) {
        return bibleCrossSets.harvest;
      }
      if (t.includes("halloween") || style === "party") {
        return bibleCrossSets.halloween;
      }
      // default: halloween-style cross-match
      return bibleCrossSets.halloween;
    }

    // ---------- STATE ----------

    let currentPairs = []; // [{number, clue, letter, candy, verse?}]
    let currentMode = "candy"; // "candy" or "cross"

    // ---------- GENERATION LOGIC ----------

    function generateGame({ shuffleOnly = false } = {}) {
      const theme = $("themeInput").value.trim();
      const style = $("styleSelect").value;

      const crossMatchOn = $("crossMatchToggle").classList.contains(
        "toggle-active"
      );

      currentMode = crossMatchOn ? "cross" : "candy";

      // Title / subtitle from inputs
      const titleInput = $("titleInput").value.trim();
      const subtitleInput = $("subtitleInput").value.trim();

      $("gameTitle").textContent =
        titleInput || (crossMatchOn ? "BIBLE MATCH" : "CANDY MATCH");
      $("answerTitle").textContent = $("gameTitle").textContent;
      $("subtitleDisplay").textContent =
        subtitleInput ||
        (crossMatchOn
          ? "Match the terms with their related Bible verse below."
          : "Match the clue to the candy it describes!");

      $("answerKeyHeading").textContent = "ANSWER KEY";

      let clues = [];
      let extras = [];

      if (crossMatchOn) {
        // Bible Cross-Match mode: terms + verses
        const set = getCrossSetFromTheme(theme, style);
        clues = set.terms.slice(0, PROPLUS_LINES);
        extras = set.verses.slice(0, PROPLUS_LINES);
      } else {
        // Normal candy match: clues from manual list, candies from locale
        const manual = cleanWordList($("wordList").value);
        if (!manual.length) {
          // Provide a soft default set based on theme
          const fallback =
            theme.toLowerCase().includes("bible") ||
            theme.toLowerCase().includes("verse")
              ? [
                  "GOOD BOOK",
                  "HOLY WRIT",
                  "SCRIPTURE",
                  "WORD OF GOD",
                  "WORD",
                  "HOLY SCRIPTURE",
                  "GOSPEL",
                  "BIBLICAL",
                  "TORAH",
                  "SACRED"
                ]
              : [
                  "HOLIDAY HAPPINESS",
                  "LOTS OF GIFTS",
                  "REINDEER BREAK",
                  "STAR OF BETHLEHEM",
                  "MISCHIEVOUS ELVES",
                  "NORTH POLE",
                  "SHEPHERD'S STAFF",
                  "SANTA'S SLEIGH",
                  "SNOWMAN POOP",
                  "COWBOY SANTA"
                ];
          clues = fallback.slice(0, PROPLUS_LINES);
        } else {
          clues = manual.slice(0, PROPLUS_LINES);
        }
        extras = getCandyList();
      }

      // ensure we have at least as many extras as clues
      const needed = clues.length;
      let rightSide = shuffle(extras).slice(0, Math.max(needed, 10));
      if (rightSide.length < needed) {
        // pad from candy/bible list reused
        const more = shuffle(extras);
        while (rightSide.length < needed) {
          rightSide.push(more[rightSide.length % more.length]);
        }
      }

      // letters A, B, C...
      const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");

      // Build pairs
      const indices = [...Array(clues.length).keys()];
      const shuffledIndices = shuffle(indices);

      currentPairs = clues.map((clue, idx) => {
        const candyIndex = shuffledIndices[idx];
        return {
          number: idx + 1,
          clue,
          letter: letters[idx],
          rightText: rightSide[candyIndex]
        };
      });

      renderPages();
    }

    function renderPages() {
      const clueListEl = $("clueList");
      const candyListEl = $("candyList");
      const answerClueListEl = $("answerClueList");
      const answerCandyListEl = $("answerCandyList");

      clueListEl.innerHTML = "";
      candyListEl.innerHTML = "";
      answerClueListEl.innerHTML = "";
      answerCandyListEl.innerHTML = "";

      const answerColor = $("answerColorPicker").value || "#c81e1e";
      document.documentElement.style.setProperty(
        "--answer-color",
        answerColor
      );

      // Right column uses same order for both pages
      const rightItems = currentPairs.map((p) => p.rightText);
      const letters = currentPairs.map((p) => p.letter);

      // --- Game page ---
      currentPairs.forEach((pair) => {
        const clueRow = document.createElement("div");
        clueRow.className = "clue-row";

        const blank = document.createElement("span");
        blank.className = "blank";

        const number = document.createElement("span");
        number.className = "number";
        number.textContent = pair.number + ".";

        const clueText = document.createElement("span");
        clueText.className = "clue-text editable";
        clueText.textContent = pair.clue;

        clueText.contentEditable = "true";
        clueText.addEventListener("input", () => {
          pair.clue = clueText.textContent.trim();
          renderAnswerPageOnly();
        });

        clueRow.appendChild(blank);
        clueRow.appendChild(number);
        clueRow.appendChild(clueText);
        clueListEl.appendChild(clueRow);
      });

      rightItems.forEach((text, idx) => {
        const row = document.createElement("div");
        row.className = "candy-row";

        const letterSpan = document.createElement("span");
        letterSpan.className = "candy-letter";
        letterSpan.textContent = letters[idx] + ".";

        const textSpan = document.createElement("span");
        textSpan.className = "candy-text editable";
        textSpan.textContent = text;
        textSpan.contentEditable = "true";
        textSpan.addEventListener("input", () => {
          const newText = textSpan.textContent.trim();
          currentPairs.forEach((p, i) => {
            if (i === idx) {
              p.rightText = newText;
            }
          });
          renderAnswerPageOnly();
        });

        row.appendChild(letterSpan);
        row.appendChild(textSpan);
        candyListEl.appendChild(row);
      });

      renderAnswerPageOnly();
    }

    function renderAnswerPageOnly() {
      const answerClueListEl = $("answerClueList");
      const answerCandyListEl = $("answerCandyList");
      answerClueListEl.innerHTML = "";
      answerCandyListEl.innerHTML = "";

      const answerColor = $("answerColorPicker").value || "#c81e1e";
      document.documentElement.style.setProperty(
        "--answer-color",
        answerColor
      );

      const letters = currentPairs.map((p) => p.letter);
      const rightItems = currentPairs.map((p) => p.rightText);

      // Left side: same clue text, but with letter above blank
      currentPairs.forEach((pair) => {
        const row = document.createElement("div");
        row.className = "clue-row";

        const blank = document.createElement("span");
        blank.className = "blank answer";

        const letterSpan = document.createElement("span");
        letterSpan.className = "answer-letter";
        letterSpan.textContent = pair.letter;
        blank.appendChild(letterSpan);

        const number = document.createElement("span");
        number.className = "number";
        number.textContent = pair.number + ".";

        const clueText = document.createElement("span");
        clueText.className = "clue-text";
        clueText.textContent = pair.clue;

        row.appendChild(blank);
        row.appendChild(number);
        row.appendChild(clueText);
        answerClueListEl.appendChild(row);
      });

      // Right side: A. Candy Name (reference list)
      rightItems.forEach((text, idx) => {
        const row = document.createElement("div");
        row.className = "candy-row";

        const letterSpan = document.createElement("span");
        letterSpan.className = "candy-letter";
        letterSpan.textContent = letters[idx] + ".";

        const textSpan = document.createElement("span");
        textSpan.className = "candy-text";
        textSpan.textContent = text;

        row.appendChild(letterSpan);
        row.appendChild(textSpan);
        answerCandyListEl.appendChild(row);
      });
    }

    // ---------- EVENT WIRING ----------

    $("generateBtn").addEventListener("click", () => generateGame());
    $("quickRegenerateBtn").addEventListener("click", () =>
      generateGame({ shuffleOnly: true })
    );

    $("answerColorPicker").addEventListener("input", () =>
      renderAnswerPageOnly()
    );

    $("gridOverlayCheckbox").addEventListener("change", (e) => {
      const on = e.target.checked;
      $("gamePage").classList.toggle("grid-overlay", on);
      $("answerPage").classList.toggle("grid-overlay", on);
    });

    $("crossMatchToggle").addEventListener("click", () => {
      $("crossMatchToggle").classList.toggle("toggle-active");
      generateGame();
    });

    $("uploadTxtBtn").addEventListener("click", () => {
      $("hiddenFileInput").click();
    });

    $("hiddenFileInput").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (evt) => {
        const existing = $("wordList").value;
        const added = evt.target.result || "";
        $("wordList").value =
          (existing ? existing + "\n" : "") + added.trim();
      };
      reader.readAsText(file);
      e.target.value = "";
    });

    $("cleanSortBtn").addEventListener("click", () => {
      const cleaned = Array.from(
        new Set(cleanWordList($("wordList").value.toUpperCase()))
      ).sort();
      $("wordList").value = cleaned.join("\n");
    });

    $("titleInput").addEventListener("input", () => {
      $("gameTitle").textContent =
        $("titleInput").value.trim() || "CANDY MATCH";
      $("answerTitle").textContent = $("gameTitle").textContent;
    });

    $("subtitleInput").addEventListener("input", () => {
      $("subtitleDisplay").textContent =
        $("subtitleInput").value.trim() ||
        (currentMode === "cross"
          ? "Match the terms with their related Bible verse below."
          : "Match the clue to the candy it describes!");
    });

    $("printBtn").addEventListener("click", () => {
      window.print();
    });

    // Initial generation
    generateGame();
  </script>
</body>
</html>
